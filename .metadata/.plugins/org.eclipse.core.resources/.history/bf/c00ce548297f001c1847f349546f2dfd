package com.p1;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.time.LocalDate;
import java.util.List;

import org.springframework.jdbc.core.JdbcOperations;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;

import com.pojo.Accounts;
import com.pojo.Banking;

public class BankDao {
JdbcTemplate template;
	
	public void setTemplate(JdbcTemplate template) {
		this.template=template;
	}
	
	public int tran(Banking b,Accounts a,String prc) {
		int x=2022+a.getAcnum()+(int)(Math.random()*10000);
		LocalDate date=java.time.LocalDate.now();
		String dt=date.toString();
		String sql="insert into banking values("+x+","+a+","+dt+","+b.getAmt()+","+prc+")";
		return ((JdbcOperations) template).update(sql);
		}
	
	public int deposit(Accounts a,Banking b) {
		String sql="update accounts set Bal=Bal+"+b.getAmt()+"where Ac_num="+a.getAcnum();
		tran(b,a,"Deposit");
		return ((JdbcOperations) template).update(sql);
	}
	public int withdraw(Accounts a,Banking b) {
		String sql="update accounts set Bal=Bal-"+b.getAmt()+"where Ac_num="+a.getAcnum();
		tran(b,a,"Withdraw");
		return ((JdbcOperations) template).update(sql);
	}
	public List<Accounts>getAccounts(int acnum){
		return ((JdbcOperations) template).query("select* from accounts where Ac_num="+acnum+"",new RowMapper<Accounts>() {
			public Accounts mapRow(ResultSet rs,int row)throws SQLException{
				Accounts a=new Accounts();
				a.setAcnum(rs.getInt(1));
				a.setCid(rs.getInt(2));
				a.setActyp(rs.getString(3));
				a.setDop(rs.getString(4));
				a.setBal(rs.getInt(5));
				a.setSts(rs.getString(6));
			}
		});
	}
	
}
